# ë¶ˆêµ ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼ - GraphQL Schema
# DDD ê¸°ë°˜ ë„ë©”ì¸ ëª¨ë¸ë§

# ==========================================
# ğŸ” AUTHENTICATION & USER MANAGEMENT
# ==========================================

type User @model @auth(rules: [
  { allow: owner }
  { allow: private, operations: [read] }
  { allow: groups, groups: ["Moderators"], operations: [read, update] }
]) {
  id: ID!
  username: String! @index(name: "byUsername")
  email: String!
  
  # ê°œì¸ ì •ë³´
  fullName: String
  temple: String @index(name: "byTemple")
  dharmaName: String
  level: UserLevel!
  joinDate: AWSDate!
  
  # í”„ë¡œí•„ ì´ë¯¸ì§€
  profileImage: String
  
  # ìˆ˜í–‰ ê´€ë ¨
  practiceYears: Int
  specialties: [PracticeSpecialty!]
  
  # ê´€ê³„í˜• ë°ì´í„°
  reviews: [Review] @hasMany(indexName: "byUser", fields: ["id"])
  posts: [Post] @hasMany(indexName: "byAuthor", fields: ["id"])
  chatMessages: [ChatMessage] @hasMany(indexName: "byUser", fields: ["id"])
  meditationSessions: [MeditationSession] @hasMany(indexName: "byUser", fields: ["id"])
  
  # íŒ”ë¡œìš° ê´€ê³„
  following: [Follow] @hasMany(indexName: "byFollower", fields: ["id"])
  followers: [Follow] @hasMany(indexName: "byFollowing", fields: ["id"])
  
  # í†µê³„
  reviewCount: Int @default(value: "0")
  postCount: Int @default(value: "0")
  meditationMinutes: Int @default(value: "0")
  
  # ì„¤ì •
  isActive: Boolean! @default(value: "true")
  notifications: NotificationSettings
  privacy: PrivacySettings
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum UserLevel {
  SEEKER        # êµ¬ë„ì
  PRACTITIONER  # ìˆ˜í–‰ì  
  EXPERIENCED   # ê²½í—˜ì
  GUIDE         # ì•ˆë‚´ì
  TEACHER       # ì§€ë„ì
  MASTER        # ë²•ì‚¬
}

enum PracticeSpecialty {
  MEDITATION    # ëª…ìƒ
  SUTRA_STUDY   # ê²½ì „ ê³µë¶€
  CHANTING      # ì—¼ë¶ˆ
  MINDFULNESS   # ë§ˆìŒì±™ê¹€
  YOGA          # ìš”ê°€
  TEA_CEREMONY  # ì°¨ ëª…ìƒ
}

type NotificationSettings {
  reviews: Boolean! @default(value: "true")
  comments: Boolean! @default(value: "true")
  mentions: Boolean! @default(value: "true")
  follows: Boolean! @default(value: "true")
  dharmaUpdates: Boolean! @default(value: "true")
}

type PrivacySettings {
  profileVisibility: VisibilityLevel! @default(value: "PUBLIC")
  reviewVisibility: VisibilityLevel! @default(value: "PUBLIC")
  practiceVisibility: VisibilityLevel! @default(value: "FRIENDS")
}

enum VisibilityLevel {
  PUBLIC
  FRIENDS
  PRIVATE
}

# ==========================================
# ğŸ›ï¸ DHARMA REVIEW DOMAIN
# ==========================================

type DharmaSession @model @auth(rules: [
  { allow: public, operations: [read] }
  { allow: groups, groups: ["Moderators", "ContentCreators"], operations: [create, update, delete] }
]) {
  id: ID!
  title: String!
  
  # ê¸°ë³¸ ì •ë³´
  temple: String! @index(name: "byTemple")
  monk: String!
  date: AWSDateTime! @index(name: "byDate")
  duration: Int # minutes
  capacity: Int
  
  # ì½˜í…ì¸ 
  description: String
  category: DharmaCategory! @index(name: "byCategory")
  tags: [String!]
  language: Language! @default(value: "KOREAN")
  
  # ë¯¸ë””ì–´
  images: [String!]
  audioUrl: String
  videoUrl: String
  
  # ê´€ê³„í˜• ë°ì´í„°
  reviews: [Review] @hasMany(indexName: "byDharmaSession", fields: ["id"])
  attendees: [Attendance] @hasMany(indexName: "byDharmaSession", fields: ["id"])
  
  # í†µê³„ ë° ì§‘ê³„
  avgRating: Float @default(value: "0")
  reviewCount: Int @default(value: "0")
  attendeeCount: Int @default(value: "0")
  
  # ìƒíƒœ
  status: SessionStatus! @default(value: "SCHEDULED")
  isOnline: Boolean! @default(value: "false")
  onlineUrl: String
  
  # ë©”íƒ€ë°ì´í„°
  createdBy: String!
  isActive: Boolean! @default(value: "true")
  isFeatured: Boolean @default(value: "false")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum DharmaCategory {
  MEDITATION      # ëª…ìƒ
  SUTRA_STUDY     # ê²½ì „ ê³µë¶€
  DHARMA_TALK     # ë²•ë¬¸
  CEREMONY        # ì˜ì‹/ë²•íšŒ
  RETREAT         # ìˆ˜ë ¨íšŒ
  DISCUSSION      # í† ë¡ /ë¬¸ë‹µ
  CHANTING        # ì—¼ë¶ˆ
  TEA_CEREMONY    # ì°¨ ëª…ìƒ
  WALKING_MEDITATION # í–‰ì„ 
  COMMUNITY_SERVICE  # ë´‰ì‚¬
}

enum SessionStatus {
  SCHEDULED   # ì˜ˆì •
  ONGOING     # ì§„í–‰ì¤‘
  COMPLETED   # ì™„ë£Œ
  CANCELLED   # ì·¨ì†Œ
  POSTPONED   # ì—°ê¸°
}

enum Language {
  KOREAN
  ENGLISH
  CHINESE
  JAPANESE
}

type Review @model @auth(rules: [
  { allow: public, operations: [read] }
  { allow: owner, operations: [create, update, delete] }
  { allow: groups, groups: ["Moderators"], operations: [update, delete] }
]) {
  id: ID!
  
  # ê´€ê³„
  dharmaSessionId: ID! @index(name: "byDharmaSession")
  dharmaSession: DharmaSession @belongsTo(fields: ["dharmaSessionId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  # í‰ê°€
  rating: Int! # 1-5
  title: String!
  content: String!
  
  # ì„¸ë¶€ í‰ê°€
  contentQuality: Int # 1-5
  teachingClarity: Int # 1-5
  atmosphere: Int # 1-5
  
  # ë¯¸ë””ì–´
  images: [String!]
  
  # ê²€ì¦
  isVerified: Boolean @default(value: "false")
  attendanceVerified: Boolean @default(value: "false")
  
  # ìƒí˜¸ì‘ìš©
  comments: [Comment] @hasMany(indexName: "byReview", fields: ["id"])
  likes: [ReviewLike] @hasMany(indexName: "byReview", fields: ["id"])
  reports: [ReviewReport] @hasMany(indexName: "byReview", fields: ["id"])
  
  # í†µê³„
  likeCount: Int @default(value: "0")
  commentCount: Int @default(value: "0")
  helpfulCount: Int @default(value: "0")
  
  # ë©”íƒ€ë°ì´í„°
  isPublished: Boolean! @default(value: "true")
  language: Language! @default(value: "KOREAN")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Comment @model @auth(rules: [
  { allow: public, operations: [read] }
  { allow: owner, operations: [create, update, delete] }
  { allow: groups, groups: ["Moderators"], operations: [delete] }
]) {
  id: ID!
  
  # ê´€ê³„
  reviewId: ID! @index(name: "byReview")
  review: Review @belongsTo(fields: ["reviewId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  # ëŒ€ëŒ“ê¸€ ì§€ì›
  parentCommentId: ID @index(name: "byParentComment")
  parentComment: Comment @belongsTo(fields: ["parentCommentId"])
  replies: [Comment] @hasMany(indexName: "byParentComment", fields: ["id"])
  
  # ì½˜í…ì¸ 
  content: String!
  
  # ìƒí˜¸ì‘ìš©
  likes: [CommentLike] @hasMany(indexName: "byComment", fields: ["id"])
  likeCount: Int @default(value: "0")
  
  # ë©”íƒ€ë°ì´í„°
  isActive: Boolean! @default(value: "true")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

# ==========================================
# ğŸ’¬ COMMUNITY COMMUNICATION DOMAIN
# ==========================================

type Post @model @auth(rules: [
  { allow: public, operations: [read] }
  { allow: owner, operations: [create, update, delete] }
  { allow: groups, groups: ["Moderators"], operations: [update, delete] }
]) {
  id: ID!
  
  # ì‘ì„±ì
  authorId: ID! @index(name: "byAuthor")
  author: User @belongsTo(fields: ["authorId"])
  
  # ì½˜í…ì¸ 
  title: String!
  content: String!
  excerpt: String
  
  # ì¹´í…Œê³ ë¦¬
  category: PostCategory! @index(name: "byCategory")
  tags: [String!]
  
  # ë¯¸ë””ì–´
  images: [String!]
  attachments: [String!]
  
  # ìƒí˜¸ì‘ìš©
  comments: [PostComment] @hasMany(indexName: "byPost", fields: ["id"])
  likes: [PostLike] @hasMany(indexName: "byPost", fields: ["id"])
  
  # í†µê³„
  viewCount: Int @default(value: "0")
  likeCount: Int @default(value: "0")
  commentCount: Int @default(value: "0")
  shareCount: Int @default(value: "0")
  
  # ìƒíƒœ
  status: PostStatus! @default(value: "PUBLISHED")
  isPinned: Boolean @default(value: "false")
  isFeatured: Boolean @default(value: "false")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum PostCategory {
  DISCUSSION    # í† ë¡ 
  QUESTION      # ì§ˆë¬¸
  SHARING       # ë‚˜ëˆ”
  NEWS          # ì†Œì‹
  EVENT         # í–‰ì‚¬
  STUDY         # ê³µë¶€
  MEDITATION    # ëª…ìƒ
  DAILY_LIFE    # ì¼ìƒ
}

enum PostStatus {
  DRAFT
  PUBLISHED
  HIDDEN
  DELETED
}

type ChatRoom @model @auth(rules: [
  { allow: private }
  { allow: groups, groups: ["Moderators"], operations: [create, update, delete] }
]) {
  id: ID!
  name: String!
  description: String
  
  # íƒ€ì…
  type: ChatRoomType! @default(value: "PUBLIC")
  category: ChatCategory!
  
  # ë©¤ë²„ì‹­
  members: [ChatMember] @hasMany(indexName: "byChatRoom", fields: ["id"])
  messages: [ChatMessage] @hasMany(indexName: "byChatRoom", fields: ["id"])
  
  # ì„¤ì •
  maxMembers: Int @default(value: "100")
  isActive: Boolean! @default(value: "true")
  
  # í†µê³„
  memberCount: Int @default(value: "0")
  messageCount: Int @default(value: "0")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum ChatRoomType {
  PUBLIC
  PRIVATE
  DIRECT_MESSAGE
}

enum ChatCategory {
  GENERAL       # ì¼ë°˜
  MEDITATION    # ëª…ìƒ
  STUDY         # ê³µë¶€
  TEMPLE_LIFE   # ì‚¬ì°°ìƒí™œ
  BEGINNERS     # ì´ˆì‹¬ì
  ADVANCED      # ìˆ™ë ¨ì
}

type ChatMessage @model @auth(rules: [
  { allow: private }
]) {
  id: ID!
  
  # ê´€ê³„
  chatRoomId: ID! @index(name: "byChatRoom")
  chatRoom: ChatRoom @belongsTo(fields: ["chatRoomId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  # ì½˜í…ì¸ 
  content: String!
  messageType: MessageType! @default(value: "TEXT")
  
  # ë¯¸ë””ì–´
  mediaUrl: String
  mediaType: String
  
  # ìƒí˜¸ì‘ìš©
  reactions: [MessageReaction] @hasMany(indexName: "byMessage", fields: ["id"])
  
  # ë©”íƒ€ë°ì´í„°
  isEdited: Boolean @default(value: "false")
  isDeleted: Boolean @default(value: "false")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  AUDIO
  SYSTEM
}

# ==========================================
# ğŸ§˜ PRACTICE MANAGEMENT DOMAIN
# ==========================================

type MeditationSession @model @auth(rules: [
  { allow: owner }
  { allow: private, operations: [read] }
]) {
  id: ID!
  
  # ì‚¬ìš©ì
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  # ì„¸ì…˜ ì •ë³´
  title: String
  type: MeditationType!
  duration: Int! # minutes
  
  # ì¼ì •
  scheduledDate: AWSDateTime
  actualStartTime: AWSDateTime
  actualEndTime: AWSDateTime
  
  # ë‚´ìš©
  notes: String
  mood: MoodLevel
  focus: FocusLevel
  insights: String
  
  # ê°€ì´ë“œ
  guidedBy: String
  audioGuide: String
  
  # ìƒíƒœ
  status: SessionStatus!
  isCompleted: Boolean! @default(value: "false")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum MeditationType {
  SITTING         # ì¢Œì„ 
  WALKING         # í–‰ì„ 
  CHANTING        # ì—¼ë¶ˆ
  BREATHING       # í˜¸í¡ëª…ìƒ
  MINDFULNESS     # ë§ˆìŒì±™ê¹€
  LOVING_KINDNESS # ìë¹„ëª…ìƒ
  BODY_SCAN       # ë°”ë””ìŠ¤ìº”
  VISUALIZATION   # ê´€ìƒëª…ìƒ
}

enum MoodLevel {
  VERY_LOW
  LOW
  NEUTRAL
  HIGH
  VERY_HIGH
}

enum FocusLevel {
  VERY_POOR
  POOR
  AVERAGE
  GOOD
  EXCELLENT
}

# ==========================================
# ğŸ”„ SUPPORTING ENTITIES
# ==========================================

# ì¶œì„ ê´€ë¦¬
type Attendance @model @auth(rules: [
  { allow: owner }
  { allow: groups, groups: ["Moderators"], operations: [read, create, update] }
]) {
  id: ID!
  dharmaSessionId: ID! @index(name: "byDharmaSession")
  dharmaSession: DharmaSession @belongsTo(fields: ["dharmaSessionId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  status: AttendanceStatus!
  checkInTime: AWSDateTime
  checkOutTime: AWSDateTime
  notes: String
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum AttendanceStatus {
  REGISTERED
  CHECKED_IN
  ATTENDED
  NO_SHOW
  CANCELLED
}

# íŒ”ë¡œìš° ê´€ê³„
type Follow @model @auth(rules: [
  { allow: owner }
  { allow: private, operations: [read] }
]) {
  id: ID!
  followerId: ID! @index(name: "byFollower")
  follower: User @belongsTo(fields: ["followerId"])
  followingId: ID! @index(name: "byFollowing")
  following: User @belongsTo(fields: ["followingId"])
  
  createdAt: AWSDateTime!
}

# ì¢‹ì•„ìš” ì‹œìŠ¤í…œ
type ReviewLike @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  reviewId: ID! @index(name: "byReview")
  review: Review @belongsTo(fields: ["reviewId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  createdAt: AWSDateTime!
}

type CommentLike @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  commentId: ID! @index(name: "byComment")
  comment: Comment @belongsTo(fields: ["commentId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  createdAt: AWSDateTime!
}

type PostLike @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  postId: ID! @index(name: "byPost")
  post: Post @belongsTo(fields: ["postId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  createdAt: AWSDateTime!
}

type PostComment @model @auth(rules: [
  { allow: public, operations: [read] }
  { allow: owner, operations: [create, update, delete] }
]) {
  id: ID!
  postId: ID! @index(name: "byPost")
  post: Post @belongsTo(fields: ["postId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  content: String!
  parentCommentId: ID
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ChatMember @model @auth(rules: [{ allow: private }]) {
  id: ID!
  chatRoomId: ID! @index(name: "byChatRoom")
  chatRoom: ChatRoom @belongsTo(fields: ["chatRoomId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  role: ChatRole! @default(value: "MEMBER")
  joinedAt: AWSDateTime!
  lastReadAt: AWSDateTime
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum ChatRole {
  ADMIN
  MODERATOR
  MEMBER
}

type MessageReaction @model @auth(rules: [{ allow: private }]) {
  id: ID!
  messageId: ID! @index(name: "byMessage")
  message: ChatMessage @belongsTo(fields: ["messageId"])
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  reaction: String! # emoji
  
  createdAt: AWSDateTime!
}

# ì‹ ê³  ì‹œìŠ¤í…œ
type ReviewReport @model @auth(rules: [
  { allow: owner }
  { allow: groups, groups: ["Moderators"] }
]) {
  id: ID!
  reviewId: ID! @index(name: "byReview")
  review: Review @belongsTo(fields: ["reviewId"])
  reporterId: ID! @index(name: "byReporter")
  reporter: User @belongsTo(fields: ["reporterId"])
  
  reason: ReportReason!
  description: String
  status: ReportStatus! @default(value: "PENDING")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum ReportReason {
  INAPPROPRIATE_CONTENT
  SPAM
  HARASSMENT
  FALSE_INFORMATION
  COPYRIGHT_VIOLATION
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  REJECTED
}

# ==========================================
# ğŸ”” NOTIFICATIONS
# ==========================================

type Notification @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
  
  type: NotificationType!
  title: String!
  content: String!
  
  # ê´€ë ¨ ë¦¬ì†ŒìŠ¤
  relatedId: String
  relatedType: String
  
  # ìƒíƒœ
  isRead: Boolean! @default(value: "false")
  isArchived: Boolean @default(value: "false")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum NotificationType {
  REVIEW_COMMENT
  REVIEW_LIKE
  POST_COMMENT
  POST_LIKE
  FOLLOW
  MENTION
  DHARMA_SESSION_REMINDER
  SYSTEM_ANNOUNCEMENT
}
# ğŸ‡°ğŸ‡· í•œêµ­ ë¶ˆêµ ì»¤ë®¤ë‹ˆí‹° ì „ìš© GraphQL ìŠ¤í‚¤ë§ˆ
# ë¹„ìš© ìµœì í™” + ì„±ëŠ¥ ìµœì í™” + í•œêµ­ ë¶ˆêµ íŠ¹í™”

# ==========================================
# ğŸ›ï¸ í•œêµ­ ì‚¬ì°° ì •ë³´
# ==========================================
type Temple @model 
  @auth(rules: [
    { allow: public, operations: [read] }
    { allow: groups, groups: ["ìš´ì˜ì"], operations: [create, update, delete] }
  ]) {
  id: ID!
  name: String! @index(name: "byName", queryField: "searchTemples")
  branch: String! # ì¡°ê³„ì¢…, ì²œíƒœì¢…, ì§„ê°ì¢… ë“±
  address: KoreanAddress!
  contact: Contact
  description: String
  features: [String!] # ì£¼ì°¨ì¥, ë²•ë‹¹, ìš”ì‚¬ì±„ ë“±
  dharmaSessions: [DharmaSession] @hasMany
  avgRating: Float
  reviewCount: Int @default(value: "0")
  isActive: Boolean! @default(value: "true")
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type KoreanAddress {
  roadAddress: String! # ë„ë¡œëª… ì£¼ì†Œ
  jibunAddress: String # ì§€ë²ˆ ì£¼ì†Œ
  sido: String! # ì‹œë„
  sigungu: String! # ì‹œêµ°êµ¬
  dong: String # ë™/ì/ë©´
  zipCode: String!
  latitude: Float
  longitude: Float
}

type Contact {
  phone: String @regex(pattern: "^01[016789]-?\\d{3,4}-?\\d{4}$")
  email: String @email
  website: String @url
  kakaoId: String
}

# ==========================================
# ğŸ™ ë²•íšŒ ì •ë³´ (í•œêµ­ íŠ¹í™”)
# ==========================================
type DharmaSession @model 
  @auth(rules: [
    { allow: public, operations: [read] }
    { allow: groups, groups: ["ìš´ì˜ì", "ë²•ì‚¬"], operations: [create, update, delete] }
  ]) {
  id: ID!
  title: String! @index(name: "byTitle")
  templeId: ID! @index(name: "byTemple")
  temple: Temple @belongsTo
  
  # í•œêµ­ ë¶ˆêµ íŠ¹í™” ì¹´í…Œê³ ë¦¬
  category: KoreanDharmaCategory! @index(name: "byCategory")
  type: SessionType! @default(value: "REGULAR")
  
  # ì¼ì • ì •ë³´
  startDateTime: AWSDateTime! @index(name: "byDate", sortKeyFields: ["startDateTime"])
  endDateTime: AWSDateTime!
  isRecurring: Boolean @default(value: "false")
  recurringPattern: RecurringPattern
  
  # ì§„í–‰ì ì •ë³´
  monk: MonkInfo!
  assistants: [String!] # ë³´ì¡° ì§„í–‰ì
  
  # ì°¸ê°€ ì •ë³´
  maxParticipants: Int
  currentParticipants: Int @default(value: "0")
  ageRestriction: AgeGroup
  prerequisites: [String!] # ì‚¬ì „ ì¤€ë¹„ë¬¼, ë³µì¥ ì•ˆë‚´ ë“±
  
  # ë‚´ìš©
  description: String!
  materials: [String!] # ê²½ì „, êµì¬ ë“±
  language: Language! @default(value: "KOREAN")
  
  # ìœ„ì¹˜ ë° ì ‘ê·¼ì„±
  location: SessionLocation!
  accessibility: [AccessibilityFeature!] # íœ ì²´ì–´, ì£¼ì°¨ì¥ ë“±
  
  # ë¦¬ë·° ë° í‰ê°€
  reviews: [Review] @hasMany
  avgRating: Float @default(value: "0")
  reviewCount: Int @default(value: "0")
  
  # ìƒíƒœ
  status: SessionStatus! @default(value: "SCHEDULED")
  registrationRequired: Boolean @default(value: "false")
  isFeatured: Boolean @default(value: "false")
  
  # ë¹„ìš© ì •ë³´ (ë¬´ë£Œ ì›ì¹™ì´ì§€ë§Œ ë³´ì‹œ/ê³µì–‘ ì•ˆë‚´)
  offering: OfferingInfo
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum KoreanDharmaCategory {
  GENERAL_DHARMA     # ì¼ë°˜ ë²•íšŒ
  MORNING_CHANTING   # ì•„ì¹¨ ì˜ˆë¶ˆ
  EVENING_CHANTING   # ì €ë… ì˜ˆë¶ˆ
  MEDITATION         # ì°¸ì„ /ëª…ìƒ
  SUTRA_STUDY        # ê²½ì „ ê³µë¶€
  DHARMA_TALK        # ë²•ë¬¸
  YOUTH_DHARMA       # ì²­ë…„ ë²•íšŒ
  CHILDREN_DHARMA    # ì–´ë¦°ì´ ë²•íšŒ
  FAMILY_DHARMA      # ê°€ì¡± ë²•íšŒ
  SPECIAL_CEREMONY   # íŠ¹ë³„ ì˜ì‹ (49ì¬, ì²œë„ì¬ ë“±)
  RETREAT            # ìˆ˜ë ¨íšŒ/í…œí”ŒìŠ¤í…Œì´
  COMMUNITY_SERVICE  # ë´‰ì‚¬ í™œë™
  CULTURAL_EVENT     # ë¬¸í™” í–‰ì‚¬
  LOTUS_LANTERN      # ì—°ë“± ë²•íšŒ
  BUDDHA_BIRTHDAY    # ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ 
}

enum SessionType {
  REGULAR      # ì •ê¸° ë²•íšŒ
  SPECIAL      # íŠ¹ë³„ ë²•íšŒ
  RETREAT      # ìˆ˜ë ¨íšŒ
  CEREMONY     # ì˜ì‹
  EDUCATION    # êµìœ¡
  PILGRIMAGE   # ìˆœë¡€
}

type RecurringPattern {
  frequency: Frequency!
  interval: Int! # ë§¤ì£¼, ê²©ì£¼, ë§¤ì›” ë“±
  dayOfWeek: [DayOfWeek!] # ìš”ì¼
  endDate: AWSDateTime
}

enum Frequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum DayOfWeek {
  MONDAY
  TUESDAY  
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

type MonkInfo {
  name: String!
  title: String # ìŠ¤ë‹˜, ë²•ì‚¬, ì „ë²•ì‚¬ ë“±
  temple: String
  biography: String
  specialties: [String!] # ì „ë¬¸ ë¶„ì•¼
  profileImage: String @url
}

enum AgeGroup {
  ALL_AGES      # ì „ ì—°ë ¹
  CHILDREN      # ì–´ë¦°ì´ (6-12ì„¸)
  YOUTH         # ì²­ì†Œë…„ (13-19ì„¸)
  YOUNG_ADULT   # ì²­ë…„ (20-35ì„¸)
  ADULT         # ì„±ì¸ (36-64ì„¸)
  SENIOR        # ì‹œë‹ˆì–´ (65ì„¸+)
}

enum Language {
  KOREAN
  ENGLISH
  MIXED
}

type SessionLocation {
  building: String! # ëŒ€ì›…ì „, ë²•ë‹¹, ì„ ë°© ë“±
  floor: String
  room: String
  capacity: Int
  equipment: [String!] # ë°©ì†¡ ì‹œì„¤, í”„ë¡œì í„° ë“±
}

enum AccessibilityFeature {
  WHEELCHAIR_ACCESSIBLE  # íœ ì²´ì–´ ì ‘ê·¼ ê°€ëŠ¥
  PARKING_AVAILABLE     # ì£¼ì°¨ì¥ ì´ìš© ê°€ëŠ¥
  PUBLIC_TRANSPORT     # ëŒ€ì¤‘êµí†µ ì ‘ê·¼ ìš©ì´
  ELEVATOR            # ì—˜ë¦¬ë² ì´í„°
  RESTROOM           # í™”ì¥ì‹¤
  NURSING_ROOM       # ìˆ˜ìœ ì‹¤
}

enum SessionStatus {
  SCHEDULED   # ì˜ˆì •
  ONGOING     # ì§„í–‰ ì¤‘
  COMPLETED   # ì™„ë£Œ
  CANCELLED   # ì·¨ì†Œ
  POSTPONED   # ì—°ê¸°
  FULL        # ë§ˆê°
}

type OfferingInfo {
  suggestedAmount: Int # ê¶Œì¥ ë³´ì‹œê¸ˆ (ì›)
  description: String # ë³´ì‹œê¸ˆ ì‚¬ìš©ì²˜ ì„¤ëª…
  acceptsCard: Boolean @default(value: "false")
  acceptsAccount: Boolean @default(value: "true")
  accountInfo: String # ê³„ì¢Œ ì •ë³´
}

# ==========================================
# ğŸ“ ë¦¬ë·° ì‹œìŠ¤í…œ (í•œêµ­ì–´ íŠ¹í™”)
# ==========================================
type Review @model 
  @auth(rules: [
    { allow: public, operations: [read] }
    { allow: owner, operations: [create, update, delete] }
    { allow: groups, groups: ["ìš´ì˜ì"], operations: [update, delete] }
  ]) {
  id: ID!
  dharmaSessionId: ID! @index(name: "byDharmaSession")
  dharmaSession: DharmaSession @belongsTo
  userId: ID! @index(name: "byUser") 
  
  # í‰ê°€
  rating: Int! # 1-5ì 
  title: String!
  content: String!
  
  # ì„¸ë¶€ í‰ê°€ (í•œêµ­ ë¶ˆêµ íŠ¹í™”)
  contentQuality: Int      # ë²•ë¬¸/ë‚´ìš©ì˜ ì§ˆ
  teachingClarity: Int     # ì„¤ë²•ì˜ ëª…í™•ì„±  
  spiritualInspiration: Int # ì˜ì  ê°í™”
  practiceGuidance: Int    # ìˆ˜í–‰ ì§€ë„
  atmosphere: Int          # ë¶„ìœ„ê¸°
  accessibility: Int       # ì ‘ê·¼ì„±/í¸ì˜ì„±
  
  # ì¶”ì²œ ëŒ€ìƒ
  recommendedFor: [AgeGroup!]
  difficultyLevel: DifficultyLevel!
  
  # ë¯¸ë””ì–´
  photos: [String!] @url
  
  # ê²€ì¦
  isVerified: Boolean @default(value: "false")
  attendanceVerified: Boolean @default(value: "false")
  
  # ìƒí˜¸ì‘ìš©
  comments: [Comment] @hasMany
  likes: [ReviewLike] @hasMany
  helpfulCount: Int @default(value: "0")
  
  # ìƒíƒœ
  isPublished: Boolean! @default(value: "true")
  language: Language! @default(value: "KOREAN")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum DifficultyLevel {
  BEGINNER    # ì´ˆì‹¬ì
  INTERMEDIATE # ì¤‘ê¸‰ì
  ADVANCED    # ìˆ™ë ¨ì
  EXPERT      # ì „ë¬¸ê°€
}

# ==========================================
# ğŸ’¬ ëŒ“ê¸€ ì‹œìŠ¤í…œ
# ==========================================
type Comment @model 
  @auth(rules: [
    { allow: public, operations: [read] }
    { allow: owner, operations: [create, update, delete] }
    { allow: groups, groups: ["ìš´ì˜ì"], operations: [delete] }
  ]) {
  id: ID!
  reviewId: ID! @index(name: "byReview")
  review: Review @belongsTo
  userId: ID! @index(name: "byUser")
  
  content: String!
  parentCommentId: ID
  parentComment: Comment @belongsTo
  replies: [Comment] @hasMany
  
  isEdited: Boolean @default(value: "false")
  isDeleted: Boolean @default(value: "false")
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

# ==========================================
# ğŸ‘ ì¢‹ì•„ìš” ì‹œìŠ¤í…œ
# ==========================================
type ReviewLike @model 
  @auth(rules: [{ allow: owner }]) {
  id: ID!
  reviewId: ID! @index(name: "byReview")
  review: Review @belongsTo
  userId: ID! @index(name: "byUser")
  
  createdAt: AWSDateTime!
}

# ==========================================
# ğŸ”” ì•Œë¦¼ ì‹œìŠ¤í…œ (í•œêµ­ì–´)
# ==========================================
type Notification @model
  @auth(rules: [{ allow: owner }]) {
  id: ID!
  userId: String! @index(name: "byUser")
  type: NotificationType!
  title: String!
  message: String!
  data: String # JSON ë¬¸ìì—´
  isRead: Boolean! @default(value: "false")
  createdAt: AWSDateTime!
}

enum NotificationType {
  NEW_REVIEW         # ìƒˆ ë¦¬ë·° ë“±ë¡
  COMMENT_REPLY      # ëŒ“ê¸€ ë‹µê¸€
  REVIEW_LIKED       # ë¦¬ë·° ì¢‹ì•„ìš”
  DHARMA_REMINDER    # ë²•íšŒ ì•Œë¦¼
  DHARMA_CANCELLED   # ë²•íšŒ ì·¨ì†Œ
  DHARMA_UPDATED     # ë²•íšŒ ë³€ê²½
  TEMPLE_NEWS        # ì‚¬ì°° ì†Œì‹
  SYSTEM_NOTICE      # ì‹œìŠ¤í…œ ê³µì§€
}

# ==========================================
# ğŸ“Š í•œêµ­ ì‚¬ìš©ì í†µê³„ (ê°œì¸ì •ë³´ ë³´í˜¸)
# ==========================================
type UserStats @model
  @auth(rules: [{ allow: owner }]) {
  id: ID! 
  userId: String! @index(name: "byUser")
  
  # í™œë™ í†µê³„
  reviewCount: Int @default(value: "0")
  sessionAttendance: Int @default(value: "0")
  totalPracticeHours: Int @default(value: "0")
  
  # ì§€ì—­ë³„ í†µê³„ (ê°œì¸ì •ë³´ ì œê±°)
  preferredRegion: String # ì‹œë„ ë‹¨ìœ„ë§Œ
  practiceLevel: DifficultyLevel @default(value: "BEGINNER")
  
  # ê´€ì‹¬ ë¶„ì•¼
  interests: [KoreanDharmaCategory!]
  
  updatedAt: AWSDateTime!
}

# ==========================================
# ğŸ“ˆ í”Œë«í¼ í†µê³„ (ë¹„ìš© ìµœì í™”)
# ==========================================
type PlatformStats @model
  @auth(rules: [
    { allow: groups, groups: ["ìš´ì˜ì"], operations: [read] }
  ]) {
  id: ID!
  date: AWSDate! @index(name: "byDate")
  
  # ì¼ë³„ í†µê³„
  dailyActiveUsers: Int
  newRegistrations: Int
  sessionCreated: Int
  reviewsWritten: Int
  
  # ì§€ì—­ë³„ í†µê³„
  regionStats: String # JSON ë¬¸ìì—´ë¡œ ì €ì¥ (DynamoDB ë¹„ìš© ì ˆì•½)
  
  createdAt: AWSDateTime!
}

# 🪷 Buddhist Community - Amplify 빌드 설정
# 한국 불교 커뮤니티 플랫폼

version: 1

# 프론트엔드 단계
frontend:
  phases:
    preBuild:
      commands:
        - echo "🪷 Buddhist Community 빌드 시작"
        - echo "Node version:"
        - node --version
        - echo "NPM version:"
        - npm --version
        - echo "DEPLOY_TARGET=amplify" >> .env
        - echo "의존성 설치 중..."
        - npm ci
    build:
      commands:
        - echo "🏛️ 불교 커뮤니티 빌드 시작..."
        - DEPLOY_TARGET=amplify npm run build
        - echo "빌드 완료, dist 폴더 확인..."
        - ls -la dist/
        - echo "Index.html 내용:"
        - head -10 dist/index.html
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*

# 환경별 설정
environments:
  prod:
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
            - echo "VITE_APP_STAGE=production" >> .env
            - echo "VITE_TARGET_COUNTRY=KR" >> .env
            - echo "VITE_DEFAULT_LANGUAGE=ko" >> .env
        build:
          commands:
            - npm run build:korea
  dev:
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
            - echo "VITE_APP_STAGE=development" >> .env
            - echo "VITE_TARGET_COUNTRY=KR" >> .env
        build:
          commands:
            - npm run build:korea

# 사용자 정의 헤더 (보안 + 성능)
customHeaders:
  - pattern: '**'
    headers:
      - key: 'Strict-Transport-Security'
        value: 'max-age=31536000; includeSubDomains'
      - key: 'X-Frame-Options'
        value: 'DENY'
      - key: 'X-Content-Type-Options'
        value: 'nosniff'
      - key: 'Cache-Control'
        value: 'public, max-age=31536000'
  - pattern: '*.html'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=0, must-revalidate'
  - pattern: 'static/js/*.js'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
  - pattern: 'static/css/*.css'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
# ğŸ‡°ğŸ‡· Buddhist Community Korea - Amplify ë¹Œë“œ ì„¤ì •
# í•œêµ­ ì‹œì¥ íŠ¹í™” + ë¹„ìš© ìµœì í™”

version: 1

# ë°±ì—”ë“œ ë‹¨ê³„
backend:
  phases:
    build:
      commands:
        - '# í•œêµ­ ì „ìš© ë°±ì—”ë“œ ë°°í¬'
        - amplifyPush --simple

# í”„ë¡ íŠ¸ì—”ë“œ ë‹¨ê³„
frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸ‡°ğŸ‡· Buddhist Community Korea ë¹Œë“œ ì‹œì‘"
        - echo "Node version:"
        - node --version
        - echo "NPM version:"
        - npm --version
        - '# í•œêµ­ ì „ìš© í™˜ê²½ ì„¤ì •'
        - echo "AWS_DEFAULT_REGION=ap-northeast-2" >> .env
        - echo "VITE_TARGET_COUNTRY=KR" >> .env
        - echo "VITE_DEFAULT_LANGUAGE=ko" >> .env
        - echo "VITE_TIMEZONE=Asia/Seoul" >> .env
        - echo "VITE_CURRENCY=KRW" >> .env
        - echo "í•œêµ­ ì „ìš© ì¢…ì†ì„± ì„¤ì¹˜ ì¤‘..."
        - npm ci
    build:
      commands:
        - echo "ğŸ›ï¸ í•œêµ­ì–´ ìµœì í™” ë¹Œë“œ ì‹œì‘..."
        - npm run build:korea
        - echo "ë¹Œë“œ ì™„ë£Œ, dist í´ë” í™•ì¸..."
        - ls -la dist/
        - echo "Index.html ë‚´ìš©:"
        - head -10 dist/index.html
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*

# í™˜ê²½ë³„ ì„¤ì •
environments:
  prod:
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
            - echo "VITE_APP_STAGE=production" >> .env
            - echo "VITE_TARGET_COUNTRY=KR" >> .env
            - echo "VITE_DEFAULT_LANGUAGE=ko" >> .env
        build:
          commands:
            - npm run build:korea
  dev:
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
            - echo "VITE_APP_STAGE=development" >> .env
            - echo "VITE_TARGET_COUNTRY=KR" >> .env
        build:
          commands:
            - npm run build:korea

# ì‚¬ìš©ì ì •ì˜ í—¤ë” (ë³´ì•ˆ + ì„±ëŠ¥)
customHeaders:
  - pattern: '**'
    headers:
      - key: 'Strict-Transport-Security'
        value: 'max-age=31536000; includeSubDomains'
      - key: 'X-Frame-Options'
        value: 'DENY'
      - key: 'X-Content-Type-Options'
        value: 'nosniff'
      - key: 'Cache-Control'
        value: 'public, max-age=31536000'
  - pattern: '*.html'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=0, must-revalidate'
  - pattern: 'static/js/*.js'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
  - pattern: 'static/css/*.css'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'